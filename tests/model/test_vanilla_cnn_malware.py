from unittest.mock import MagicMock

import torch

from src.model.vanilla import VanillaCNNMalware


def test_vanilla_cnn_malware():
    num_classes = 2
    hparams = MagicMock(num_classes=num_classes, num_tasks=5, dropout=0.2)
    model = VanillaCNNMalware(hparams)
    assert model.task is None

    model.set_task(0)
    print(model)
    batch_size, C, H, W = 10, 1, 64, 64
    y = torch.randn(batch_size, C, H, W)
    output = model(y)
    assert output.shape == (10, num_classes)
